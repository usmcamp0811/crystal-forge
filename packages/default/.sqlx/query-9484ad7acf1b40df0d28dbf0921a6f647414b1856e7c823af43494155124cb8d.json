{
  "db_name": "PostgreSQL",
  "query": "\n        WITH latest_commit AS (\n          SELECT id\n          FROM commits\n          WHERE flake_id = $1\n          ORDER BY commit_timestamp DESC\n          LIMIT 1\n        ),\n        per_host AS (\n          SELECT\n            d.derivation_name                         AS hostname,\n            d.id                                       AS derivation_id,\n            d.derivation_target                        AS derivation_target,\n            MAX(cpj.completed_at)                      AS last_cache_completed_at,\n            ROW_NUMBER() OVER (\n              PARTITION BY d.derivation_name\n              ORDER BY MAX(cpj.completed_at) DESC NULLS LAST,\n                       MAX(d.completed_at) DESC NULLS LAST,\n                       MAX(d.id) DESC\n            ) AS rn\n          FROM derivations d\n          JOIN latest_commit lc\n            ON d.commit_id = lc.id\n          JOIN cache_push_jobs cpj\n            ON cpj.derivation_id = d.id\n           AND cpj.status = 'completed'\n          WHERE d.derivation_type = 'nixos'\n            AND d.derivation_target IS NOT NULL\n            AND d.derivation_name = ANY($2::text[])\n          GROUP BY d.derivation_name, d.id, d.derivation_target\n        )\n        SELECT hostname, derivation_id, derivation_target, last_cache_completed_at\n        FROM per_host\n        WHERE rn = 1\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "hostname",
        "type_info": "Text"
      },
      {
        "ordinal": 1,
        "name": "derivation_id",
        "type_info": "Int4"
      },
      {
        "ordinal": 2,
        "name": "derivation_target",
        "type_info": "Text"
      },
      {
        "ordinal": 3,
        "name": "last_cache_completed_at",
        "type_info": "Timestamptz"
      }
    ],
    "parameters": {
      "Left": [
        "Int4",
        "TextArray"
      ]
    },
    "nullable": [
      false,
      false,
      true,
      null
    ]
  },
  "hash": "9484ad7acf1b40df0d28dbf0921a6f647414b1856e7c823af43494155124cb8d"
}
